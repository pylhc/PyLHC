mylhcbeam = 4;
call, file="/afs/cern.ch/eng/lhc/optics/runII/2018/toolkit/macro.madx";
call, file="/afs/cern.ch/eng/lhc/optics/runII/2018/lhcb4_as-built.seq";
slicefactor = 4;
beam;
call, file="/afs/cern.ch/eng/lhc/optics/runII/2018/toolkit/myslice.madx";
beam;
use, sequence=lhcb2;
makethin, sequence=lhcb2, style=teapot, makedipedge=true;
seqedit, sequence=lhcb2;
flatten;
cycle, start=IP3;
endedit;
call, file="/afs/cern.ch/eng/lhc/optics/runII/2018/PROTON/opticsfile.22_ctpps2";
beam, sequence=lhcb2, bv=1, energy:=NRJ, particle=proton, npart=10000000000.0, kbunch=1, ex=7.29767146889e-09, ey=7.29767146889e-09;
on_crab1 = 0;
on_crab5 = 0;
on_o1 = 0;
on_sep2 = 1.4;
on_oe2 = 0;
on_ov2 = 0;
on_o5 = 0;
on_ov5 = 0;
on_sep8h = 0;
on_x8v = 0;
on_alice = 0;
on_sol_alice = 0;
on_lhcb = 0;
on_sol_atlas = 0;
on_sol_cms = 0;
use, sequence=lhcb2;
match, chrom=true;
global, sequence=lhcb2, q1=62.31, q2=60.32;
vary, name="dqx.b2", step=1e-07;
vary, name="dqy.b2", step=1e-07;
lmdif, calls=100, tolerance=1e-21;
endmatch;
match, chrom=true;
global, sequence=lhcb2, dq1=3, dq2=3;
vary, name="dqpx.b2", step=1e-07;
vary, name="dqpy.b2", step=1e-07;
lmdif, calls=100, tolerance=1e-21;
endmatch;
match, chrom=true;
global, sequence=lhcb2, q1=62.31, q2=60.32, dq1=3, dq2=3;
vary, name="dqx.b2", step=1e-07;
vary, name="dqy.b2", step=1e-07;
vary, name="dqpx.b2", step=1e-07;
vary, name="dqpy.b2", step=1e-07;
lmdif, calls=100, tolerance=1e-21;
endmatch;
twiss, sequence=lhcb2, file="twiss.lhc.b4.nominal.tfs";
quit;
