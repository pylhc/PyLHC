mylhcbeam = 1;
call, file="/afs/cern.ch/eng/lhc/optics/runII/2018/toolkit/macro.madx";
call, file="/afs/cern.ch/eng/lhc/optics/runII/2018/lhc_as-built.seq";
slicefactor = 4;
beam;
call, file="/afs/cern.ch/eng/lhc/optics/runII/2018/toolkit/myslice.madx";
beam;
use, sequence=lhcb1;
makethin, sequence=lhcb1, style=teapot, makedipedge=true;
seqedit, sequence=lhcb1;
flatten;
cycle, start=IP3;
endedit;
call, file="/afs/cern.ch/eng/lhc/optics/runII/2018/PROTON/opticsfile.22_ctpps2";
beam, sequence=lhcb1, bv=1, energy:=NRJ, particle=proton, npart=10000000000.0, kbunch=1, ex=7.29767146889e-09, ey=7.29767146889e-09;
on_crab1 = 0;
on_crab5 = 0;
on_o1 = 0;
on_sep2 = 1.4;
on_oe2 = 0;
on_ov2 = 0;
on_o5 = 0;
on_ov5 = 0;
on_sep8h = 0;
on_x8v = 0;
on_alice = 0;
on_sol_alice = 0;
on_lhcb = 0;
on_sol_atlas = 0;
on_sol_cms = 0;
use, sequence=lhcb1;
match, chrom=true;
global, sequence=lhcb1, q1=62.31, q2=60.32;
vary, name="dqx.b1", step=1e-07;
vary, name="dqy.b1", step=1e-07;
lmdif, calls=100, tolerance=1e-21;
endmatch;
match, chrom=true;
global, sequence=lhcb1, dq1=3, dq2=3;
vary, name="dqpx.b1", step=1e-07;
vary, name="dqpy.b1", step=1e-07;
lmdif, calls=100, tolerance=1e-21;
endmatch;
match, chrom=true;
global, sequence=lhcb1, q1=62.31, q2=60.32, dq1=3, dq2=3;
vary, name="dqx.b1", step=1e-07;
vary, name="dqy.b1", step=1e-07;
vary, name="dqpx.b1", step=1e-07;
vary, name="dqpy.b1", step=1e-07;
lmdif, calls=100, tolerance=1e-21;
endmatch;
twiss, sequence=lhcb1, file="twiss.lhc.b1.nominal.tfs";
quit;
