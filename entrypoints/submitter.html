

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>HTCondor Job Submitter &mdash; pylhc 0.1.1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="BPM Calibration Utilities" href="../modules/calibration.html" />
    <link rel="prev" title="Machine Information Tools" href="machine_info.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/omc_logo.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Entrypoints</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="analysis.html">Analysis Tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="analysis.html#bsrt-analysis">BSRT Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="analysis.html#forced-da-analysis">Forced DA Analysis</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="bpm_calibration.html">BPM Calibration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="bpm_calibration.html#id1">BPM Calibration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="machine_info.html">Machine Information Tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="machine_info.html#print-machine-settings-overview">Print Machine Settings Overview</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">HTCondor Job Submitter</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#job-submitter">Job Submitter</a></li>
<li class="toctree-l2"><a class="reference internal" href="#autosix">AutoSix</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules/calibration.html">BPM Calibration Utilities</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/calibration.html#beta">Beta</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/calibration.html#dispersion">Dispersion</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/constants.html">Constants Definitions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/constants.html#constants-general">Constants: General</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/constants.html#constants-external-paths">Constants: External Paths</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/constants.html#constants-autosix">Constants: Autosix</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/constants.html#constants-forced-da-analysis">Constants: Forced DA Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/constants.html#constants-machine-settings-info">Constants: Machine Settings Info</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/constants.html#constants-bpm-calibration">Constants: BPM Calibration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/data_extract.html">Data Extraction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/data_extract.html#pylsa">PyLSA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/data_extract.html#timber">Timber</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/htc.html">HTCondor Tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/htc.html#htcondor-utilities">HTCondor Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/htc.html#mask-resolver">Mask Resolver</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/sixdesk_tools.html">Sixdesk Tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/sixdesk_tools.html#create-sixdesk-workspace">Create SixDesk Workspace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/sixdesk_tools.html#sixdesk-submission-utils">SixDesk Submission Utils</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/sixdesk_tools.html#post-process-da">Post Process DA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/sixdesk_tools.html#sixdesk-utilities">SixDesk Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/sixdesk_tools.html#sixdesk-troubleshooting-tools">SixDesk Troubleshooting tools</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">pylhc</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>HTCondor Job Submitter</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/entrypoints/submitter.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-pylhc.job_submitter">
<span id="htcondor-job-submitter"></span><h1>HTCondor Job Submitter<a class="headerlink" href="#module-pylhc.job_submitter" title="Permalink to this headline">¶</a></h1>
<div class="section" id="job-submitter">
<h2>Job Submitter<a class="headerlink" href="#job-submitter" title="Permalink to this headline">¶</a></h2>
<p>Allows to execute a parametric study using a script-mask and a <cite>dictionary</cite> with parameters to
replace, from the command line. The parameters to be replaced must be present in the given mask as
<code class="docutils literal notranslate"><span class="pre">%(PARAMETER)s</span></code> (other types apart from string also allowed).</p>
<p>The type of script and executable is freely choosable, but defaults to <code class="docutils literal notranslate"><span class="pre">madx</span></code> - for which this
submitter was originally written.</p>
<p>When submitting to <code class="docutils literal notranslate"><span class="pre">HTCondor</span></code>, data to be transferred back to the working directory must be
written in a sub-folder defined by <code class="docutils literal notranslate"><span class="pre">job_output_directory</span></code> which defaults to <strong>Outputdata</strong>.</p>
<p>This script also allows to check if all <code class="docutils literal notranslate"><span class="pre">HTCondor</span></code> jobs finished successfully, for resubmissions
with a different parameter grid, and for local execution.</p>
<p>A <strong>Jobs.tfs</strong> file is created in the working directory containing the Job Id, parameter per job
and job directory for further post processing.</p>
<p><em>--Required--</em></p>
<ul class="simple">
<li><p><strong>mask</strong> <em>(str)</em>: Script Mask to use</p></li>
<li><p><strong>replace_dict</strong> <em>(DictAsString)</em>: Dict containing the str to replace as
keys and values a list of parameters to replace</p></li>
<li><p><strong>working_directory</strong> <em>(str)</em>: Directory where data should be put</p></li>
</ul>
<p><em>--Optional--</em></p>
<ul>
<li><p><strong>append_jobs</strong>: Flag to rerun job with finer/wider grid,
already existing points will not be reexecuted.</p>
<p>Action: <code class="docutils literal notranslate"><span class="pre">store_true</span></code></p>
</li>
<li><p><strong>check_files</strong> <em>(str)</em>: List of files/file-name-masks expected to be in the
‘job_output_dir’ after a successful job (for appending/resuming). Uses the ‘glob’
function, so unix-wildcards (*) are allowed. If not given, only the presence of the folder itself is checked.</p></li>
<li><p><strong>dryrun</strong>: Flag to only prepare folders and scripts,
but does not start madx/submit jobs.
Together with <cite>resume_jobs</cite> this can be use to check which jobs succeeded and which failed.</p>
<p>Action: <code class="docutils literal notranslate"><span class="pre">store_true</span></code></p>
</li>
<li><p><strong>executable</strong> <em>(str)</em>: Path to executable or job-type (of [‘madx’, ‘python3’, ‘python2’]) to use.</p></li>
<li><p><strong>htc_arguments</strong> <em>(DictAsString)</em>: Additional arguments for htcondor, as Dict-String.
For AccountingGroup please use ‘accounting_group’. ‘max_retries’ and ‘notification’ have defaults (if not given).
Others are just passed on.</p>
<p>Default: <code class="docutils literal notranslate"><span class="pre">{}</span></code></p>
</li>
<li><p><strong>job_output_dir</strong> <em>(str)</em>: The name of the output dir of the job. (Make sure your script puts its data there!)</p>
<p>Default: <code class="docutils literal notranslate"><span class="pre">Outputdata</span></code></p>
</li>
<li><p><strong>jobflavour</strong> <em>(str)</em>: Jobflavour to give rough estimate of runtime of one job</p>
<p>Choices: <code class="docutils literal notranslate"><span class="pre">('espresso',</span> <span class="pre">'microcentury',</span> <span class="pre">'longlunch',</span> <span class="pre">'workday',</span> <span class="pre">'tomorrow',</span> <span class="pre">'testmatch',</span> <span class="pre">'nextweek')</span></code>
Default: <code class="docutils literal notranslate"><span class="pre">workday</span></code></p>
</li>
<li><p><strong>jobid_mask</strong> <em>(str)</em>: Mask to name jobs from replace_dict</p></li>
<li><p><strong>num_processes</strong> <em>(int)</em>: Number of processes to be used if run locally</p>
<p>Default: <code class="docutils literal notranslate"><span class="pre">4</span></code></p>
</li>
<li><p><strong>resume_jobs</strong>: Only do jobs that did not work.</p>
<p>Action: <code class="docutils literal notranslate"><span class="pre">store_true</span></code></p>
</li>
<li><p><strong>run_local</strong>: Flag to run the jobs on the local machine. Not suggested.</p>
<p>Action: <code class="docutils literal notranslate"><span class="pre">store_true</span></code></p>
</li>
<li><p><strong>script_arguments</strong> <em>(DictAsString)</em>: Additional arguments to pass to the script,
as dict in key-value pairs (‘--‘ need to be included in the keys).</p>
<p>Default: <code class="docutils literal notranslate"><span class="pre">{}</span></code></p>
</li>
<li><p><strong>script_extension</strong> <em>(str)</em>: New extension for the scripts created from the masks.
This is inferred automatically for [‘madx’, ‘python3’, ‘python2’]. Otherwise not changed.</p></li>
<li><p><strong>ssh</strong> <em>(str)</em>: Run htcondor from this machine via ssh (needs access to the <cite>working_directory</cite>)</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">author</dt>
<dd class="field-odd"><p>mihofer, jdilly</p>
</dd>
</dl>
<dl class="py function">
<dt class="sig sig-object py" id="pylhc.job_submitter.check_replace_dict">
<span class="sig-prename descclassname"><span class="pre">pylhc.job_submitter.</span></span><span class="sig-name descname"><span class="pre">check_replace_dict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">replace_dict</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">dict</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">collections.OrderedDict</span><a class="reference internal" href="../_modules/pylhc/job_submitter.html#check_replace_dict"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pylhc.job_submitter.check_replace_dict" title="Permalink to this definition">¶</a></dt>
<dd><p>Makes all entries in replace-dict iterable.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pylhc.job_submitter.keys_to_path">
<span class="sig-prename descclassname"><span class="pre">pylhc.job_submitter.</span></span><span class="sig-name descname"><span class="pre">keys_to_path</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dict_</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">keys</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pylhc/job_submitter.html#keys_to_path"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pylhc.job_submitter.keys_to_path" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert all keys to Path</p>
</dd></dl>

</div>
<span class="target" id="module-pylhc.autosix"></span><div class="section" id="autosix">
<h2>AutoSix<a class="headerlink" href="#autosix" title="Permalink to this headline">¶</a></h2>
<p>A wrapper for SixDesk to perform the setup and steps needed automatically.</p>
<p>The idea is, to call this script with the same parameters and it runs through
all the steps automatically.</p>
<p>The functionality is similar to the <a class="reference internal" href="#module-pylhc.job_submitter" title="pylhc.job_submitter"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pylhc.job_submitter</span></code></a> in that
the inner product of a <code class="docutils literal notranslate"><span class="pre">replace_dict</span></code> is used to automatically create a set of
job-directories to gather the data.
To avoid conflicts each of these job-directories is a SixDesk workspace,
meaning there will be only one “study” per directory, .</p>
<p>The <code class="docutils literal notranslate"><span class="pre">replace_dict</span></code> contains variables for your mask as well as variables
for the SixDesk environment. See the description of <code class="docutils literal notranslate"><span class="pre">replace_dict</span></code> below.
In any other way, these <em>special</em> variables behave like normal variables and
can also be inserted in your mask. They are also looped over in the same manner
as any other variable (if given as a list).</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>As the loop over Seeds is handled by SixDesk you need to set
<cite>FIRSTSEED</cite> and <cite>LASTSEED</cite> to <code class="docutils literal notranslate"><span class="pre">None</span></code> or <code class="docutils literal notranslate"><span class="pre">0</span></code> to deactivate this loop.
Otherwise a <code class="docutils literal notranslate"><span class="pre">%SEEDRAN</span></code> placeholder is required in your mask,
which needs to be present <strong>after</strong> filling in the variables (see example below).</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Unlike in the <a class="reference internal" href="#module-pylhc.job_submitter" title="pylhc.job_submitter"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pylhc.job_submitter</span></code></a>, the output directory of the
HTCondor job (the ‘mask-job’) is not automatically transferred to the
workspace. To have access to this data, you will need to specify different
output-directories in your mask manually, e.g. using strings containing
the variable placeholders.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">omc3.utils</span> <span class="kn">import</span> <span class="n">logging_tools</span>
<span class="kn">from</span> <span class="nn">pylhc</span> <span class="kn">import</span> <span class="n">autosix</span>

<span class="n">LOG</span> <span class="o">=</span> <span class="n">logging_tools</span><span class="o">.</span><span class="n">get_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">autosix</span><span class="o">.</span><span class="n">main</span><span class="p">(</span>
        <span class="n">working_directory</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;/afs/cern.ch/work/u/user/sixdeskbase&#39;</span><span class="p">),</span>
        <span class="n">mask</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;my_madx.mask&#39;</span><span class="p">),</span> <span class="c1"># can contain any of the parameters used in replace_dict</span>
        <span class="n">python</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;/afs/cern.ch/work/u/user/my_venv/bin/python&#39;</span><span class="p">),</span>
        <span class="n">ignore_twissfail_check</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># if script prints &#39;check if twiss failed&#39; or similar</span>
        <span class="n">replace_dict</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="c1"># Part of the sixdesk-environment:</span>
            <span class="n">TURNS</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span>
            <span class="n">AMPMIN</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">AMPMAX</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">AMPSTEP</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">ANGLES</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span>
            <span class="c1"># Examples for mask:</span>
            <span class="n">BEAM</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
            <span class="n">TUNE</span><span class="o">=</span><span class="p">[</span><span class="mf">62.29</span><span class="p">,</span> <span class="mf">62.30</span><span class="p">,</span> <span class="mf">62.31</span><span class="p">,</span> <span class="mf">62.31</span><span class="p">]</span>
            <span class="n">OUTPUT</span><span class="o">=</span><span class="s1">&#39;/afs/cern.ch/work/u/user/study_output/&#39;</span><span class="p">,</span>
            <span class="n">SEED</span><span class="o">=</span><span class="s1">&#39;%SEEDRAN&#39;</span><span class="p">,</span>  <span class="c1"># puts &#39;%SEEDRAN&#39; in the mask and lets sixdesk handle this loop</span>
        <span class="p">),</span>
        <span class="n">jobid_mask</span><span class="o">=</span><span class="s2">&quot;B</span><span class="si">%(BEAM)d</span><span class="s2">-QX</span><span class="si">%(TUNE)s</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="c1"># unlock=True,</span>
        <span class="c1"># resubmit=True,</span>
        <span class="c1"># ssh=&#39;lxplus.cern.ch&#39;,</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>Upon running the script the job-matrix is created
(see <em>Jobs.tfs</em> in working directory) and the following stages are run per job:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">create_jobs</span></code>: create workspace; fill sysenv, sixdeskenv, mask.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">initialize_workspace</span></code>: initialize workspace from the env-files.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">submit_mask</span></code>: submit mask-job to HTCondor. (<em>interrupt</em>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">check_input</span></code>: check if sixdesk input is complete.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">submit_sixtrack</span></code>: submit sixdesk-jobs to HTCondor. (<em>interrupt</em>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">check_sixtrack_output</span></code>: check if all sixdesk jobs are completed.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sixdb_load</span></code>: create database and load jobs output.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sixdb_cmd</span></code>: calculated DA from database data.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">post_process</span></code>: extract data from database, write into <em>.tfs</em> and plot.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">final</span></code>: announce everything has finished</p></li>
</ul>
<p>To keep track of the stages, they are written into the <em>stages_completed.txt</em>
in the <em>autosix_output</em> directory in the workspaces.
Stages that are written in this file are assumed to be done and will be skipped.
To rerun a stage, delete the stage and all following stages in that file and
start your script anew.</p>
<p>The stages are run independently of each job, meaning different jobs can be
at different stages. E.g if one job has all data for the <code class="docutils literal notranslate"><span class="pre">six_db</span></code> analysis
already, but the others are still running on sixdesk the
<code class="docutils literal notranslate"><span class="pre">check_sixtrack_output</span></code> stage will fail for these jobs but the other one will
just continue.</p>
<p>Because the stages after <code class="docutils literal notranslate"><span class="pre">submit_mask</span></code> and <code class="docutils literal notranslate"><span class="pre">submit_sixtrack</span></code> need only be
run after the jobs on HTCondor are completed, these two stages interrupt the
execution of stages if they have successfully finished. Check your scheduler
via <code class="docutils literal notranslate"><span class="pre">condor_q</span></code> and run your script again after everything is done, to
have autosix continue its work.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>While most studies should be fine with the input options given, there is the
possibility to manually adapt the <em>sixdeskenv</em> and <em>sysenv</em> file before
workspace initialization but adding the switch <code class="docutils literal notranslate"><span class="pre">stop_workspace_init</span></code>.
This will not reset automatically and one will have to remove the switch
again to continue.
As this is a bit of a workaround, it might be easier to define a new
variable in the <strong>pylhc.sixdesk_tools.mask_sixdeskenv</strong> file and put its
current default into <strong>pylhc.constants.autosix.SIXENV_DEFAULT</strong>.
One can then use the <code class="docutils literal notranslate"><span class="pre">replace_dict</span></code> to change its value.
This is left open as a task for the inspired user to implement, as only he
knows which variable he or she needs to change.</p>
</div>
<p>AutoSix is not only able to run MAD-X masks, but also <strong>cpymad</strong> masks.
Requirement for the latter is to provide the <code class="docutils literal notranslate"><span class="pre">executable</span></code> path to a
python binary with <strong>cpymad</strong>, and all other packages used, installed.</p>
<p>To create the files needed for Sixtrack input, MAD-X masks need to contain</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">(</span>NRJ&lt;<span class="m">5000</span>.0000<span class="o">)</span> <span class="o">{</span>VRF400:<span class="o">=</span><span class="m">8</span>.<span class="p">;</span><span class="o">}</span> <span class="k">else</span> <span class="o">{</span>VRF400:<span class="o">=</span><span class="m">16</span>.<span class="p">;</span><span class="o">}</span><span class="p">;</span>
LAGRF400.B1<span class="o">=</span><span class="m">0</span>.5<span class="p">;</span>
LAGRF400.B2<span class="o">=</span><span class="m">0</span>.<span class="p">;</span>
twiss<span class="p">;</span>
sixtrack, cavall, <span class="nv">radius</span><span class="o">=</span><span class="m">0</span>.017<span class="p">;</span>
</pre></div>
</div>
<p>while <strong>cpymad</strong> masks can do the same task with</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">madx</span><span class="o">.</span><span class="n">globals</span><span class="p">[</span><span class="s2">&quot;VRF400&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8</span> <span class="k">if</span> <span class="n">madx</span><span class="o">.</span><span class="n">globals</span><span class="p">[</span><span class="s1">&#39;NRJ&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">5000</span> <span class="k">else</span> <span class="mi">16</span>
<span class="n">madx</span><span class="o">.</span><span class="n">globals</span><span class="p">[</span><span class="s2">&quot;LAGRF400.B1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">madx</span><span class="o">.</span><span class="n">globals</span><span class="p">[</span><span class="s2">&quot;LAGRF400.B2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
<span class="n">madx</span><span class="o">.</span><span class="n">twiss</span><span class="p">()</span>  <span class="c1"># used by sixtrack</span>
<span class="n">madx</span><span class="o">.</span><span class="n">sixtrack</span><span class="p">(</span><span class="n">cavall</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">0.017</span><span class="p">)</span>
</pre></div>
</div>
<p>In theory, any kind of mask is possible, given the correct <code class="docutils literal notranslate"><span class="pre">executable</span></code>
is provided and the Sixtrack outputfiles created.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For the creation of polar plots, the function
<a class="reference internal" href="../modules/sixdesk_tools.html#pylhc.sixdesk_tools.post_process_da.plot_polar" title="pylhc.sixdesk_tools.post_process_da.plot_polar"><code class="xref py py-func docutils literal notranslate"><span class="pre">pylhc.sixdesk_tools.post_process_da.plot_polar()</span></code></a> is available,
which is used for the basic polar plotting in the <code class="docutils literal notranslate"><span class="pre">post_process</span></code> stage,
but provides more customization features if called manually.</p>
</div>
<p>Arguments:</p>
<p><em>--Required--</em></p>
<ul>
<li><p><strong>mask</strong> <em>(PathOrStr)</em>:</p>
<blockquote>
<div><p>Program mask to use</p>
</div></blockquote>
</li>
<li><p><strong>replace_dict</strong> <em>(DictAsString)</em>:</p>
<blockquote>
<div><p>Dict with keys of the strings to be replaced in the mask (required) as
well as the mask_sixdeskenv and mask_sysenv files in the sixdesk_tools
module. Required fields are TURNS, AMPMIN, AMPMAX, AMPSTEP,
ANGLES. Optional fields are RESUBMISSION, PLATFORM, LOGLEVEL,
FIRSTSEED, LASTSEED, ENERGY, NPAIRS, EMITTANCE, DIMENSIONS, WRITEBINS.
These keys can also be used in the mask if needed. The values of this
dict are lists of values to replace these or single entries.</p>
</div></blockquote>
</li>
<li><p><strong>working_directory</strong> <em>(PathOrStr)</em>:</p>
<blockquote>
<div><p>Directory where data should be put</p>
</div></blockquote>
</li>
</ul>
<p><em>--Optional--</em></p>
<ul>
<li><p><strong>da_turnstep</strong> <em>(int)</em>:</p>
<blockquote>
<div><p>Step between turns used in DA-vs-Turns plot.</p>
<p>default: <code class="docutils literal notranslate"><span class="pre">100</span></code></p>
</div></blockquote>
</li>
<li><p><strong>executable</strong> <em>(PathOrStr)</em>:</p>
<blockquote>
<div><p>Path to executable.</p>
<p>default: <code class="docutils literal notranslate"><span class="pre">/afs/cern.ch/user/m/mad/bin/madx</span></code></p>
</div></blockquote>
</li>
<li><p><strong>apply_mad6t_hacks</strong>:</p>
<blockquote>
<div><p>Apply two hacks: Removes ‘&lt;’ in binary call and
ignore the check for ‘Twiss fail’ in the submission file.
This hack is needed in case this check greps the wrong lines,
e.g. in madx- comments. USE WITH CARE!!</p>
<p>action: <code class="docutils literal notranslate"><span class="pre">store_true</span></code></p>
</div></blockquote>
</li>
<li><p><strong>jobid_mask</strong> <em>(str)</em>:</p>
<blockquote>
<div><p>Mask to name jobs from replace_dict</p>
</div></blockquote>
</li>
<li><p><strong>python3</strong> <em>(PathOrStr)</em>:</p>
<blockquote>
<div><p>Path to python to use with sixdb (python3 with requirements
installed).</p>
<p>default: <code class="docutils literal notranslate"><span class="pre">python3</span></code></p>
</div></blockquote>
</li>
<li><p><strong>python2</strong> <em>(PathOrStr)</em>:</p>
<blockquote>
<div><p>Path to python to use with run_six.sh (python2 with requirements installed).
ONLY THE PATH TO THE DIRECTORY OF THE python BINARY IS NEEDED!
And it can’t be an Anaconda Distribution.</p>
<p>default: None (uses the first <cite>python</cite> in path)</p>
</div></blockquote>
</li>
<li><p><strong>resubmit</strong>:</p>
<blockquote>
<div><p>Resubmits if needed.</p>
<p>action: <code class="docutils literal notranslate"><span class="pre">store_true</span></code></p>
</div></blockquote>
</li>
<li><p><strong>ssh</strong> <em>(str)</em>:</p>
<blockquote>
<div><p>Run htcondor from this machine via ssh (needs access to the
<cite>working_directory</cite>)</p>
</div></blockquote>
</li>
<li><p><strong>stop_workspace_init</strong>:</p>
<blockquote>
<div><p>Stops the workspace creation before initialization, so one can make
manual changes.</p>
<p>action: <code class="docutils literal notranslate"><span class="pre">store_true</span></code></p>
</div></blockquote>
</li>
<li><p><strong>unlock</strong>:</p>
<blockquote>
<div><p>Forces unlocking of folders.</p>
<p>action: <code class="docutils literal notranslate"><span class="pre">store_true</span></code></p>
</div></blockquote>
</li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">author</dt>
<dd class="field-odd"><p>jdilly</p>
</dd>
</dl>
<dl class="py function">
<dt class="sig sig-object py" id="pylhc.autosix.main">
<span class="sig-prename descclassname"><span class="pre">pylhc.autosix.</span></span><span class="sig-name descname"><span class="pre">main</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">opt</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pylhc/autosix.html#main"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pylhc.autosix.main" title="Permalink to this definition">¶</a></dt>
<dd><p>Loop to create jobs from replace dict product matrix.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pylhc.autosix.setup_and_run">
<span class="sig-prename descclassname"><span class="pre">pylhc.autosix.</span></span><span class="sig-name descname"><span class="pre">setup_and_run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">jobname</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">basedir</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">pathlib.Path</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pylhc/autosix.html#setup_and_run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pylhc.autosix.setup_and_run" title="Permalink to this definition">¶</a></dt>
<dd><p>Main submitting procedure for single job.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>jobname</strong> (<em>str</em>) -- Name of the job/study</p></li>
<li><p><strong>basedir</strong> (<em>Path</em>) -- Working directory</p></li>
</ul>
</dd>
</dl>
<dl class="simple">
<dt>Keyword Args (optional):</dt><dd><p>unlock (bool): unlock folder
ssh (str): ssh-server to use
python (str): python binary to use for sixDB
resubmit(bool): Resubmit jobs if checks fail
da_turnstep (int): Step in turns for DA
ignore_twissfail_check (bool): Hack to ignore check for ‘Twiss fail’ after run
max_stage (str): Last stage to run</p>
</dd>
<dt>Keyword Args (needed for create jobs):</dt><dd><p>mask_text (str): Content of the mask to use.
binary_path (Path): path to binary to use in jobs
All Key=Values needed to fill the mask!
All Key=Values needed to fill the mask!</p>
</dd>
</dl>
</dd></dl>

</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../modules/calibration.html" class="btn btn-neutral float-right" title="BPM Calibration Utilities" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="machine_info.html" class="btn btn-neutral float-left" title="Machine Information Tools" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2019-2020, pyLHC/OMC-TEAM.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>